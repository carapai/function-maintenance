<div [ngClass]="dashboardShapeClass(itemData.shape)"
     class="{{isFullScreen ? 'full-screen' : ''}} dashboard-card">
  <div class="panel panel-default dashboard-block {{status.id == itemData.id ? 'block-focus' : ''}}"
       [ngClass]="{'no-borders':!show_options}">
    <div class="panel-heading dashboard-card-heading" *ngIf="show_options">
      <span *ngIf="status.id == itemData.id" appClickOutside (clickOutside)="status = {}" class="success-badge">{{status.status}}</span>
      <!--<div class="row">-->
      <!--<div class="col-md-12">-->
      <!--<h6 style="margin-top: 7px;" *ngIf="itemData.object">{{itemData.object.title ? itemData.object.title : itemData.object.displayName}}</h6>-->
      <!--</div>-->
      <!--</div>-->
      <div class="row" *ngIf="cardConfiguration.showHeadersIcons">
        <div class="col-md-12" style="position: relative;">
          <ul class="nav nav-pills navbar-left dashboard-item-header" *ngIf="canShowIcons(itemData.type)">
            <!--<li><a href=""><i class="fa fa-table"></i></a></li>-->
            <li *ngIf="filterShown">
              <ul class="list-inline" style="max-height: 30px;">
                <li>
                  <app-org-unit-filter (onOrgUnitUpdate)="updateDashboardCard($event)"
                                       [orgunit_model]="orgunit_model" [disabled]="disableOrgunit"></app-org-unit-filter>
                </li>
                <li>
                  <app-period-filter (onPeriodUpdate)="updateDashboardCard($event)" [disabled]="disablePeriod"></app-period-filter>
                </li>
              </ul>
            </li>
            <li>
              <a (click)="filterShown = !filterShown" tooltip="Filter by period and orgunit" placement="right">
                <i class="fa {{filterShown ? 'fa-times' : 'fa-filter'}}"></i>
              </a>
            </li>
            <li>
              <!--<app-dashboard-layout *ngIf="cardReady" [layout]="itemData.object.layout" [visualizationType]="currentVisualization" (onUpdate)="updateDashboardItemLayout($event)"></app-dashboard-layout>-->
            </li>
            <!--<li *ngIf="itemData.interpretationCount == 0"><a (click)="toggleInterpretation()" tooltip="share interpretation"><i class="fa fa-share-alt"></i></a></li>-->
            <!--<li *ngIf="itemData.interpretationCount > 0">-->
            <!--<a (click)="toggleInterpretation()" tooltip="{{itemData.interpretationCount}} new interpretations">-->
            <!--<span *ngIf="!isInterpretationShown && interpretationReady">-->
            <!--&lt;!&ndash;<small>{{interpretation}}</small>&ndash;&gt;-->
            <!--<span class="badge intepretation-count">{{itemData.interpretationCount}}</span>&nbsp;-->
            <!--<i class="fa fa-comments-o"></i>-->
            <!--</span>-->
            <!--<span *ngIf="isInterpretationShown"><i class="fa fa-times"></i></span>-->
            <!--</a>-->
            <!--</li>-->
          </ul>
          <ul class="nav nav-pills dashboard-item-header" style="position: absolute; right:0; top:0;">
            <!--<li><a href=""><i class="fa fa-times"></i></a></li>-->
            <!--<li><a *ngIf="!confirmDelete" (click)="confirmDelete=true" class="delete-btn" tooltip="Delete dashboard"><i class="fa fa-trash"></i></a></li>-->
            <li *ngIf="confirmDelete" class="dashboard-delete-block">
              <small>Delete?</small>
              <button (click)="deleteDashboardItem(itemData.id)" class="btn btn-danger btn-xs"><i
                class="fa fa-trash"></i></button>
              <button (click)="confirmDelete = false" class="btn btn-default btn-xs"><i class="fa fa-times"></i>
              </button>
            </li>
            <li *ngIf="!isFullScreen"><a (click)="resizeDashboard(itemData.shape)" tooltip="Resize dashboard"><i
              class="fa fa-arrows-h"></i></a></li>
            <li><a (click)="toggleFullScreen()"><i class="fa fa-expand" tooltip="Full screen"></i></a></li>
          </ul>
        </div>
      </div>
    </div>
    <div class="panel-body dashboard-item-body {{!canShowIcons(itemData.type) ? 'no-footer' : ''}}">
      <div class="row">
        <div [ngClass]="isInterpretationShown ? 'col-md-7' : 'col-md-12'">
          <!--user type section-->
          <table class="table table-hover" *ngIf="currentVisualization == 'USERS'">
            <tr>
              <th colspan="2">
                Users
              </th>
            </tr>
            <tr *ngFor="let user of itemData.users">
              <td width="95%">{{user.displayName}}</td>
              <td width="5%"><a href="">&times;</a></td>
            </tr>
          </table>
          <!--end of use type section-->

          <!--resources type section-->
          <table class="table table-hover" *ngIf="currentVisualization == 'RESOURCES'">
            <tr>
              <th colspan="2">
                Resources
              </th>
            </tr>
            <tr *ngFor="let resource of itemData.resources">
              <td width="95%">{{resource.displayName}}</td>
              <td width="5%"><a href="">&times;</a></td>
            </tr>
          </table>
          <!--end of resource type section-->
          <!--map type section-->
          <div class="text-center" *ngIf="currentVisualization == 'MAP'">
            <app-loader *ngIf="loadingMap" [loadingMessage]="'Loading map...'"></app-loader>

            <div id="info"
                 (mouseleave)="closeLayerController($event)"
                 [style.visibility]="layerController"

            >

              <div><a (click)="pinLegend()" [ngClass]="{'pinned': legendPinned}" style="cursor: pointer;"  title="pin legend"><i class="fa fa-map-pin fa-xs"></i></a></div>
              <div id="layers_division_{{mapId}}" class="legendContainer"
                   style="overflow-y: auto;overflow-x: hidden;"></div>
            </div>
            <div id="button"
                 (mouseenter)="openLayerController($event)"

                 [style.visibility]="displayMap"
                 *ngIf="showButtonLegend"
            >
              <img
                src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAy5pVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDY3IDc5LjE1Nzc0NywgMjAxNS8wMy8zMC0yMzo0MDo0MiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIEVsZW1lbnRzIDE0LjAgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OUJCQzgyMDdDRTU2MTFFNTk1Q0ZGQzk2MTlGNkY2NjYiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OUJCQzgyMDhDRTU2MTFFNTk1Q0ZGQzk2MTlGNkY2NjYiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo5QkJDODIwNUNFNTYxMUU1OTVDRkZDOTYxOUY2RjY2NiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo5QkJDODIwNkNFNTYxMUU1OTVDRkZDOTYxOUY2RjY2NiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PnV8j0MAAABmSURBVHjaYqxXZ/nPAAUffoOZjBPu/mEgFrDgkmBkZPxPkQE21lbEuQDqbKyOINYFjAwUAJxeOHzkKHEGZKn9g/vh+U8mBlJdNAhiAersoRwLtj6W8MD6+PnrUIwFqLPJjgWAAAMAR5ghoelZsw4AAAAASUVORK5CYII=">
            </div>
            <div class="map-body" [style.visibility]="displayMap">
              <h4  class="text-center item-title">{{mapProperties?.name}}</h4>
              <!--<span>{{topSelectedLayerTitle}}</span>-->
              <div id="{{mapId}}" class="map-block"></div>
            <!--<div style="height:100%" [style.visibility]="displayMap">-->

              <!--<div style="">-->
                <!--<h4 class="text-center" style="padding-top:0px!important;padding-bottom:0px!important;margin-top:0px!important;margin-bottom:0px!important;">{{mapProperties?.name}}</h4>-->

                <!--<span>{{topSelectedLayerTitle}}</span>-->
              <!--</div>-->
              <!--<div id="{{mapId}}" style="min-height:330px;width:100%;border:1px solid #e7e7e7;">-->

              <!--</div>-->
            </div>

          </div>
          <!--end of map type section-->


          <!--reports type section-->
          <table class="table table-hover" *ngIf="currentVisualization == 'REPORTS'">
            <tr>
              <th colspan="2">
                Reports
              </th>
            </tr>
            <tr *ngFor="let report of itemData.reports">
              <td width="95%">{{report.displayName}}</td>
              <td width="5%"><a href="">&times;</a></td>
            </tr>
          </table>
          <!--end of report type section-->

          <!--chart or event chart type section-->
          <div class="row"
               *ngIf="currentVisualization == 'CHART' || currentVisualization == 'EVENT_CHART' && !loadingChart && !chartHasError">
            <div class="col-md-12 chart-block {{chartObjects.length > 1 ? 'multiple-chart' : ''}}"
                 *ngFor="let chartObject of chartObjects">
              <app-loader *ngIf="loadingChart" [loadingMessage]="'Loading chart...'"></app-loader>
              <div class="chart-body" *ngIf="!loadingChart" [ng2-highcharts]="chartObject"></div>
              <!--<app-error-notifier *ngIf="chartHasError" [errorMessage]="'Something is wrong'"></app-error-notifier>-->
              <div class="chart-options" *ngIf="show_options">
                <ul class="nav nav-stacked">
                  <li *ngFor="let chartType of chartTypes">
                    <a (click)="setChartType(chartType.type)" title="{{chartType.description}}"
                       [ngClass]="currentChartType == chartType.type ? 'active-type' : ''">
                      <img [src]="chartType.icon" class="chart-option-icon" alt="">
                    </a>
                  </li>
                </ul>
              </div>
            </div>
          </div>
          <!--end of chart or event chart section-->

          <!--report table type section-->
          <div class="row"
               *ngIf="currentVisualization == 'REPORT_TABLE' || currentVisualization == 'TABLE' || currentVisualization == 'EVENT_REPORT' && !loadingTable && !tableHasError">
            <div class="col-md-12" *ngFor="let tableObject of tableObjects">
              <app-loader *ngIf="loadingTable" [loadingMessage]="'Loading ' + currentVisualization"></app-loader>
              <!--<app-error-notifier *ngIf="tableHasError" [errorMessage]="'Something is wrong'"></app-error-notifier>-->
              <h4 *ngIf="!loadingTable && !tableHasError" class="text-center item-title">{{itemData.object ? itemData.object.displayName : itemData.mapObject.name}}</h4>
              <h5 style="margin-top: 80px" class="text-center" *ngIf="!loadingTable && tableObject.rows.length == 0"> No
                data to display</h5>
              <table class="table table-bordered table-responsive"
                     *ngIf="!loadingTable && !tableHasError && tableObject.rows.length != 0">
                <thead>
                <tr *ngFor="let header of tableObject.headers; let j = index">
                  <th *ngFor="let table_column of tableObject.columns; let i = index" style="text-align: center">
                    {{ tableObject.titles.rows[j] }} / {{ tableObject.titles.column[i]}}
                  </th>
                  <th *ngFor="let header_column of header.items" [colSpan]="header_column.span"
                      style="text-align: center">
                    {{ header_column.name }}
                  </th>
                </tr>
                </thead>
                <tbody>
                <tr *ngFor="let row of tableObject.rows">
                  <td *ngFor="let header_column of row.items" style="text-align: center;vertical-align: middle"
                      [attr.rowspan]="header_column.row_span">
                    {{ header_column.val }}
                  </td>
                </tr>
                </tbody>
              </table>
            </div>
          </div>
          <!--end of report table type section-->

          <!--app type section-->
          <div class="row" *ngIf="currentVisualization == 'APP'">
            <!--<iframe class="col-md-12" style="height:75vh;border:0" frameborder="0" scrolling="no" allowfullscreen="" [src]="constants.root_url + 'api/apps/' + itemData.appKey + '/index.html?dashboardItemId=' + itemData.id | safe"></iframe>-->
            <!--<app-error-notifier *ngIf="itemData.appKey" [errorMessage]="'Missing dashboard App'"></app-error-notifier>-->
          </div>
          <!--end of app type section-->

          <!--dictionary section-->
          <!--<app-metadata-dictionary *ngIf="currentVisualization == 'DICTIONARY'" [metadataidentifiers]="metadataIdentifiers"></app-metadata-dictionary>-->
          <!--end of dictionary section-->
        </div>
        <!--<div class="col-md-5" *ngIf="isInterpretationShown" style="height: 350px; overflow-y: auto">-->
        <!--<app-dashboard-item-interpretation [itemData]="itemData"></app-dashboard-item-interpretation>-->
        <!--</div>-->
      </div>
    </div>
    <div class="panel-footer dashboard-card-footer" *ngIf="canShowIcons(itemData.type) && show_options">
      <div class="row">
        <div class="col-md-12">
          <ul class="nav nav-pills dashboard-footer-nav">

            <li><a (click)="setVisualization('TABLE')"
                   [ngClass]="currentVisualization == 'TABLE' ? 'active-visualisation': ''"><i class="fa fa-table"></i></a>
            </li>
            <li><a (click)="setVisualization('CHART')"
                   [ngClass]="currentVisualization == 'CHART' ? 'active-visualisation': ''"><i
              class="fa fa-line-chart"></i></a></li>
            <li>
              <a (click)="setVisualization('MAP')"
                 [ngClass]="currentVisualization == 'MAP' ? 'active-visualisation': ''"><i class="fa fa-map"></i></a>
            </li>
            <!--<li><a (click)="setVisualization('DICTIONARY')" class="dictionary-btn" [ngClass]="currentVisualization == 'DICTIONARY' ? 'active-visualisation': ''"><i class="fa fa-info-circle"></i></a></li>-->
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>
